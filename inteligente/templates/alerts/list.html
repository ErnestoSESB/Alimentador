{% extends 'base.html' %}
{% load static %}

{% block title %}Alertas - AgroFeeder{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">
        <h1>Alertas</h1>
        <p>Monitor e gerencie alertas do sistema</p>
    </div>
    <div class="page-actions">
        <div class="alert-counters">
            <span class="counter counter-danger">{{ pending_alerts_count|default:0 }} pendentes</span>
            <span class="counter counter-success">{{ resolved_alerts_count|default:0 }} resolvidos</span>
        </div>
    </div>
</div>

<!-- Filters -->
<div class="filters-section" style="display: flex; align-items: center; justify-content: space-between;">
    <form method="get" class="filters-form" style="display: flex; align-items: center; gap: 10px;">
        <div class="filter-group">
            <select name="severity">
                <option value="">Todas as Severidades</option>
                <option value="high" {% if request.GET.severity == 'high' %}selected{% endif %}>Alto</option>
                <option value="medium" {% if request.GET.severity == 'medium' %}selected{% endif %}>Médio</option>
                <option value="low" {% if request.GET.severity == 'low' %}selected{% endif %}>Baixo</option>
            </select>
        </div>
        <div class="filter-group">
            <select name="type">
                <option value="">Todos os Tipos</option>
                <option value="low_food" {% if request.GET.type == 'low_food' %}selected{% endif %}>Nível Baixo</option>
                <option value="maintenance" {% if request.GET.type == 'maintenance' %}selected{% endif %}>Manutenção</option>
                <option value="error" {% if request.GET.type == 'error' %}selected{% endif %}>Erro</option>
                <option value="offline" {% if request.GET.type == 'offline' %}selected{% endif %}>Offline</option>
            </select>
        </div>
        <button type="submit" class="btn btn-secondary">Filtrar</button>
    </form>
    <a href="/alerts/add/" class="btn btn-primary">
        <i class="fas fa-plus"></i>
        Adicionar Alerta
    </a>
</div>

<!-- Pending Alerts -->
{% if pending_alerts %}
<div class="alerts-section pending-alerts">
    <div class="section-header alert-header">
        <h2>
            <i class="fas fa-exclamation-triangle"></i>
            Alertas Pendentes ({{ pending_alerts.count }})
        </h2>
    </div>
    
    <div class="alerts-list">
        {% for alert in pending_alerts %}
        <div class="alert-item severity-{{ alert.severity }}">
            <div class="alert-icon">
                <i class="fas fa-{% if alert.type == 'low_food' %}exclamation-triangle{% elif alert.type == 'maintenance' %}clock{% elif alert.type == 'error' %}times-circle{% else %}wifi{% endif %}"></i>
            </div>
            <div class="alert-content">
                <div class="alert-header-info">
                    <h3>{{ alert.feeder_name }}</h3>
                    <div class="alert-badges">
                        <span class="severity-badge severity-{{ alert.severity }}">
                            {% if alert.severity == 'high' %}Alto{% elif alert.severity == 'medium' %}Médio{% else %}Baixo{% endif %}
                        </span>
                        <span class="type-badge">
                            {% if alert.type == 'low_food' %}Nível Baixo{% elif alert.type == 'maintenance' %}Manutenção{% elif alert.type == 'error' %}Erro{% else %}Offline{% endif %}
                        </span>
                    </div>
                </div>
                <p class="alert-message">{{ alert.message }}</p>
                <span class="alert-time">{{ alert.created_at|date:"d/m/Y H:i" }}</span>
            </div>
            <div class="alert-actions">
                <form method="post" action="{% url 'alert_resolve' alert.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-success btn-sm">
                        <i class="fas fa-check-circle"></i>
                        Resolver
                    </button>
                </form>
                <form method="post" action="{% url 'alert_dismiss' alert.id %}" style="display: inline;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-secondary btn-sm">
                        <i class="fas fa-times"></i>
                        Descartar
                    </button>
                </form>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Resolved Alerts -->
{% if resolved_alerts %}
<div class="alerts-section resolved-alerts">
    <div class="section-header alert-header">
        <h2>
            <i class="fas fa-check-circle"></i>
            Alertas Resolvidos ({{ resolved_alerts.count }})
        </h2>
    </div>
    
    <div class="alerts-list">
        {% for alert in resolved_alerts %}
        <div class="alert-item resolved">
            <div class="alert-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="alert-content">
                <div class="alert-header-info">
                    <h3>{{ alert.feeder_name }}</h3>
                    <span class="resolved-badge">Resolvido</span>
                </div>
                <p class="alert-message">{{ alert.message }}</p>
                <span class="alert-time">{{ alert.created_at|date:"d/m/Y H:i" }}</span>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Empty State -->
{% if not pending_alerts and not resolved_alerts %}
<div class="empty-state-full">
    <div class="empty-icon">
        <i class="fas fa-check-circle"></i>
    </div>
    <h3>Nenhum alerta encontrado</h3>
    <p>
        {% if request.GET.severity or request.GET.type %}
            Tente ajustar os filtros
        {% else %}
            Todos os sistemas estão funcionando corretamente
        {% endif %}
    </p>
</div>
{% endif %}
{% endblock %}