{% extends 'base.html' %}
{% load static %}

{% block title %}Usuários - AgroFeeder{% endblock %}

{% block content %}
<div class="page-header">
    <div class="page-title">
        <h1>Usuários</h1>
        <p>Gerencie os usuários do sistema</p>
    </div>
    <div class="page-actions">
        <a href="{% url 'user_add' %}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Adicionar Usuário
        </a>
    </div>
</div>

<!-- Filters -->
<div class="filters-section">
    <form method="get" class="filters-form">
        <div class="filter-group">
            <div class="search-input">
                <i class="fas fa-search"></i>
                <input type="text" name="search" value="{{ request.GET.search }}" 
                       placeholder="Buscar por nome, email ou telefone...">
            </div>
        </div>
        <div class="filter-group">
            <select name="role">
                <option value="">Todas as Funções</option>
                <option value="admin" {% if request.GET.role == 'admin' %}selected{% endif %}>Administrador</option>
                <option value="farmer" {% if request.GET.role == 'farmer' %}selected{% endif %}>Agricultor</option>
                <option value="operator" {% if request.GET.role == 'operator' %}selected{% endif %}>Operador</option>
            </select>
        </div>
        <button type="submit" class="btn btn-secondary">Filtrar</button>
    </form>
</div>

<!-- Users List -->
<div class="users-section">
    <div class="section-header">
        <h2>{{ users.count }} usuário{{ users.count|pluralize }} encontrado{{ users.count|pluralize }}</h2>
    </div>
    
    <div class="users-list">
        {% for user in users %}
        <div class="user-item">
            <div class="user-avatar">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="user-info">
                <div class="user-header">
                    <h3>{{ user.get_full_name|default:user.username }}</h3>
                    <div class="user-role role-{{ user.profile.role|default:'operator' }}">
                        {% if user.profile.role == 'admin' %}Administrador{% elif user.profile.role == 'farmer' %}Agricultor{% else %}Operador{% endif %}
                    </div>
                </div>
                <div class="user-details">
                    <div class="user-contact">
                        <div class="contact-item">
                            <i class="fas fa-envelope"></i>
                            <span>{{ user.email }}</span>
                        </div>
                        <div class="contact-item">
                            <i class="fas fa-phone"></i>
                            <span>{{ user.profile.phone|default:'Não informado' }}</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="user-meta">
                <div class="meta-item">
                    <i class="fas fa-calendar"></i>
                    <span>Cadastro: {{ user.date_joined|date:"d/m/Y" }}</span>
                </div>
                <div class="meta-item">
                    <span>Último login: {{ user.last_login|date:"d/m/Y"|default:'Nunca' }}</span>
                </div>
            </div>
            <div class="user-actions">
                <a href="{% url 'user_detail' user.id %}" class="btn btn-outline">
                    <i class="fas fa-eye"></i>
                    Ver
                </a>
                <a href="{% url 'user_edit' user.id %}" class="btn btn-secondary">
                    <i class="fas fa-edit"></i>
                    Editar
                </a>
            </div>
        </div>
        {% empty %}
        <div class="empty-state-full">
            <div class="empty-icon">
                <i class="fas fa-users"></i>
            </div>
            <h3>Nenhum usuário encontrado</h3>
            <p>
                {% if request.GET.search or request.GET.role %}
                    Tente ajustar os filtros de busca
                {% else %}
                    Adicione o primeiro usuário para começar
                {% endif %}
            </p>
            {% if not request.GET.search and not request.GET.role %}
            <a href="{% url 'user_add' %}" class="btn btn-primary">
                Adicionar Usuário
            </a>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<!-- Pagination -->
{% if is_paginated %}
<div class="pagination-wrapper">
    <div class="pagination">
        {% if page_obj.has_previous %}
            <a href="?page=1{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.role %}&role={{ request.GET.role }}{% endif %}" class="page-link">
                <i class="fas fa-angle-double-left"></i>
            </a>
            <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.role %}&role={{ request.GET.role }}{% endif %}" class="page-link">
                <i class="fas fa-angle-left"></i>
            </a>
        {% endif %}

        <span class="page-info">
            Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
        </span>

        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.role %}&role={{ request.GET.role }}{% endif %}" class="page-link">
                <i class="fas fa-angle-right"></i>
            </a>
            <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.search %}&search={{ request.GET.search }}{% endif %}{% if request.GET.role %}&role={{ request.GET.role }}{% endif %}" class="page-link">
                <i class="fas fa-angle-double-right"></i>
            </a>
        {% endif %}
    </div>
</div>
{% endif %}
{% endblock %}